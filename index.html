<!doctype html>
<html class="no-js" lang="">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smart KX</title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="icon.png">
  <!-- Place favicon.ico in the root directory -->

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/loading.css">
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->

  <!-- Add your site or application content here -->
  <div class="container">
    <br><br>
    <div class="row">
      <h3>Welcome to SmartKX!</h3>
    </div>
    <ul class="nav nav-tabs" id="myTab" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" id="form-tab" data-toggle="tab" href="#form" role="tab" aria-controls="form" aria-selected="true">Form</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="receipts-tab" data-toggle="tab" href="#receipts" role="tab" aria-controls="receipts" aria-selected="false">Receipts</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" id="code-tab" data-toggle="tab" href="#code" role="tab" aria-controls="code" aria-selected="false">Code</a>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="form" role="tabpanel" aria-labelledby="form-tab">
        <div class="row">
          <div class="col-6">
            <div class="form-group row">
              <label for="account1" class="col-sm-3 col-form-label col-form-label-lg">Account 1</label>
              <div class="col-sm-9">
                <input type="text" class="form-control form-control-lg" id="account1" value="465,123">
              </div>
            </div>
            <div class="form-group row">
              <label for="account2" class="col-sm-3 col-form-label col-form-label-lg">Account 2</label>
              <div class="col-sm-9">
                <input type="text" class="form-control form-control-lg" id="account2" value="232,231">
              </div>
            </div>
            <div class="form-group row">
              <label for="account3" class="col-sm-3 col-form-label col-form-label-lg">Account 3</label>
              <div class="col-sm-9">
                <input type="text" class="form-control form-control-lg" id="account3" value="847,232">
              </div>
            </div>
            <div class="form-group row">
              <label for="account4" class="col-sm-3 col-form-label col-form-label-lg">Account 4</label>
              <div class="col-sm-9">
                <input type="text" class="form-control form-control-lg" id="account4" value="1,233,653">
              </div>
            </div>
            <div class="form-group row">
              <label for="account5" class="col-sm-3 col-form-label col-form-label-lg">Account 5</label>
              <div class="col-sm-9">
                <input type="text" class="form-control form-control-lg" id="account5" value="846,821">
              </div>
            </div>
            <button type="button" class="btn btn-primary" id="go">Submit</button>
            <button type="button" class="btn btn-tertiary" id="import">Import</button>
            <input type="file" value="" id="file">
          </div>
          <div class="col">
            <table class="table table-dark">
              <tr>
                <th>Range</th>
                <th>Rate</th>
                <th>Amount</th>
                <th>Result</th>
              </tr>
              <tr id="rate0">
                <td>&lt; 1MM</td>
                <td>.01</td>
                <td class="amount"></td>
                <td class="result"></td>
              </tr>
              <tr id="rate1">
                <td>1MM - 3MM</td>
                <td>.008</td>
                <td class="amount"></td>
                <td class="result"></td>
              </tr>
              <tr id="rate2">
                <td>&gt; 3MM</td>
                <td>.006</td>
                <td class="amount"></td>
                <td class="result"></td>
              </tr>
            </table>
            <br>
            <h2>Total: <span id="total"></span></h2>
            <h2>Total Billed: <span id="totalBilled"></span></h2>
            <img src="img/gear.gif" id="gear" style="display:none; position:absolute; top: 0; right: 30px;">
            </h2>
          </div>
        </div>
      </div>
    </div>
    <div class="tab-pane fade" id="receipts" role="tabpanel" aria-labelledby="receipts-tab">...</div>
    <div class="tab-pane fade" id="code" role="tabpanel" aria-labelledby="code-tab">...</div>
  </div>
  <script src="js/vendor/modernizr-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.10/lodash.min.js"></script>
  <script>window.jQuery || document.write('<script src="js/vendor/jquery-3.3.1.min.js"><\/script>')</script>
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>

  <script>
    console.log('howdy')
    var $ = jQuery;

    var rates = [
      {lower: 0, upper: 1000000, rate: .01, amount: 0, result: 0},
      {lower: 1000000.01, upper: 3000000, rate: .008, amount: 0, result: 0},
      {lower: 3000000.01, upper: Infinity, rate: .006, amount: 0, result: 0}
    ];

    $('#go').click(maths);
    $('#import').click(importNums);

    function importNums() {
      $('input[type=text]').each(function () {
        let x = _.random(122000,1400000).toLocaleString();
        $(this).val(x);
      })
    }

    function maths() {
      let total = 0;
      let totalBilled = 0;
      // collect
      $('input[type=text]').val(
        function(a, b) {
          total += parseInt(b.replace(/,/g, ''));
          return b;
        }
      );

      // gear on
      $('#gear').show();

      // compute

      rates.forEach(function(rate) {
        if (total > rate.lower) {
          console.log(`In range! ${rate.lower} - ${rate.upper}`);
          rate.amount = _.clamp(total, rate.lower, rate.upper);
          rate.result = rate.amount * rate.rate;
        }
      });
      
      totalBilled = rates[0].result + rates[1].result + rates[2].result;

      console.log(`Total - ${total.toLocaleString()}`);
      console.log(`Total Billed ${totalBilled.toLocaleString()}`);

      setTimeout(function() {
        $('#total').text('$' + total.toLocaleString());
        $('#totalBilled').text('$' + totalBilled.toLocaleString());
        $('#rate0 td.amount').text('$' + rates[0].amount.toLocaleString());
        $('#rate0 td.result').text('$' + rates[0].result.toLocaleString());
        $('#rate1 td.amount').text('$' + rates[1].amount.toLocaleString());
        $('#rate1 td.result').text('$' + rates[1].result.toLocaleString());
        $('#rate2 td.amount').text('$' + rates[2].amount.toLocaleString());
        $('#rate2 td.result').text('$' + rates[2].result.toLocaleString());

        total = 0;
        totalBilled = 0;
        $('#gear').hide();
      }, 5000);
    }
  </script>
</body>

</html>